<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
    --primary: #1a2238;
    --secondary: #9daaf2;
    --accent: #ff6a3d;
    --light: #f6f7fb;
    --dark: #1a2238;
    --success: #21e6c1;
    --warning: #ffd700;
    --card-bg: #fff;
    --shadow: 0 6px 24px rgba(26,34,56,0.08);
    --radius: 12px;
    --transition: 0.2s cubic-bezier(.4,0,.2,1);
}
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--light) 0%, #e3e6f3 100%);
    color: #222;
    min-height: 100vh;
}
.navbar {
    background: var(--primary);
    box-shadow: var(--shadow);
    border-bottom: 2px solid var(--secondary);
}
.navbar-brand {
    font-weight: 600;
    letter-spacing: 1px;
    font-size: 1.3rem;
}
.sidebar {
    background: var(--dark);
    color: #fff;
    min-height: 100vh;
    box-shadow: 2px 0 12px rgba(26,34,56,0.05);
    padding-top: 1rem;
}
.sidebar .nav-link {
    color: #c7d0e6;
    padding: 1rem 1.5rem;
    border-left: 4px solid transparent;
    font-size: 1.05rem;
    transition: background var(--transition), color var(--transition);
}
.sidebar .nav-link:hover,
.sidebar .nav-link.active {
    color: #fff;
    background: rgba(157,170,242,0.12);
    border-left-color: var(--secondary);
}
.card {
    background: var(--card-bg);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: none;
    transition: transform var(--transition), box-shadow var(--transition);
}
.card:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 12px 32px rgba(26,34,56,0.12);
}
.btn-primary {
    background: linear-gradient(90deg, var(--secondary) 60%, var(--primary) 100%);
    border: none;
    color: #fff;
    font-weight: 500;
    box-shadow: 0 2px 8px rgba(157,170,242,0.12);
    transition: background var(--transition);
}
.btn-primary:hover {
    background: linear-gradient(90deg, var(--primary) 60%, var(--secondary) 100%);
}
.btn-danger {
    background: var(--accent);
    border: none;
    color: #fff;
    font-weight: 500;
    box-shadow: 0 2px 8px rgba(255,106,61,0.12);
    transition: background var(--transition);
}
.btn-danger:hover {
    background: #d94c2b;
}
.inventory-table th {
    background: var(--primary);
    color: #fff;
    font-weight: 600;
    letter-spacing: 0.5px;
}
.inventory-table td {
    vertical-align: middle;
}
.quantity-display {
    font-size: 1.2rem;
    font-weight: bold;
}
.category-badge {
    font-size: 0.85rem;
    padding: 0.35em 0.7em;
    background: var(--secondary);
    color: var(--primary);
    border-radius: 6px;
    font-weight: 500;
}
.page-content {
    display: none;
    animation: fadeIn 0.4s;
}
.page-content.active {
    display: block;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px);}
    to { opacity: 1; transform: none;}
}
.action-btn {
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    margin: 0 0.1rem;
    transition: background var(--transition), color var(--transition);
}
.add-btn {
    color: var(--success);
}
.remove-btn {
    color: var(--accent);
}
.stat-card {
    text-align: center;
    padding: 2rem 1rem;
    background: linear-gradient(120deg, var(--secondary) 0%, var(--light) 100%);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}
.stat-number {
    font-size: 3.7rem;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 0.5rem;
}
.stat-label {
    font-size: 1.5rem;
    color: var(--dark);
    text-transform: uppercase;
    letter-spacing: 1px;
}
.loading::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.8);
    z-index: 9999;
}
.loading::after {
    content: 'Loading...';
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    padding: 12px 28px;
    background: var(--primary);
    color: #fff;
    border-radius: 6px;
    font-size: 1.2rem;
    z-index: 10000;
}
.quantity-table {
    font-size: 0.97rem;
}
.quantity-table th {
    background: var(--primary);
    color: #fff;
    cursor: pointer;
    position: relative;
}
.quantity-table th:hover {
    background: #2a3669;
}
.quantity-table th::after {
    content: '↕';
    position: absolute;
    right: 8px;
    opacity: 0.6;
}
.quantity-table th.sort-asc::after {
    content: '↑';
    opacity: 1;
}
.quantity-table th.sort-desc::after {
    content: '↓';
    opacity: 1;
}
.low-quantity {
    color: var(--accent);
    font-weight: bold;
}
.sync-status {
    position: fixed;
    bottom: 24px;
    right: 24px;
    padding: 12px 20px;
    border-radius: 6px;
    z-index: 1000;
    display: none;
    font-size: 1rem;
    font-weight: 500;
    box-shadow: var(--shadow);
}
.sync-success {
    background: var(--success);
    color: #fff;
}
.sync-error {
    background: var(--accent);
    color: #fff;
}
.sync-loading {
    background: var(--secondary);
    color: #fff;
}
.category-tab {
    cursor: pointer;
    padding: 12px 20px;
    border-radius: 8px 8px 0 0;
    margin-right: 8px;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-bottom: none;
    font-weight: 500;
    transition: background var(--transition), color var(--transition);
}
.category-tab.active {
    background: #fff;
    border-bottom: 1px solid #fff;
    margin-bottom: -1px;
    color: var(--primary);
}
.weight-input-group {
    display: flex;
}
.weight-input-group input {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
}
.weight-input-group select {
    flex: 0 0 80px;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
}
input, select, textarea {
    border-radius: 8px !important;
    border: 1px solid #dee2e6;
    transition: border var(--transition), box-shadow var(--transition);
}
input:focus, select:focus, textarea:focus {
    border-color: var(--secondary);
    box-shadow: 0 0 0 2px rgba(157,170,242,0.15);
}
.modal-content {
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}
.list-group-item {
    border-radius: 6px;
    margin-bottom: 4px;
    background: #f6f7fb;
    border: 1px solid #e3e6f3;
}
::-webkit-scrollbar {
    width: 8px;
    background: #e3e6f3;
}
::-webkit-scrollbar-thumb {
    background: var(--secondary);
    border-radius: 8px;
}

/* Dashboard specific styles */
.quantity-overview-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}
.quantity-table-container {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #e3e6f3;
    border-radius: var(--radius);
}
.quantity-table-container h6 {
    background: var(--primary);
    color: white;
    padding: 10px 15px;
    margin: 0;
    border-radius: var(--radius) var(--radius) 0 0;
    position: sticky;
    top: 0;
    z-index: 10;
}
.quantity-table {
    margin-bottom: 0;
}
.quantity-table thead th {
    position: sticky;
    top: 46px;
    z-index: 5;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .sidebar {
        min-height: 100%;
        position: static;
    }
    .stat-card {
        padding: 1.2rem 0.5rem;
    }
}
@media (max-width: 992px) {
    .sidebar {
        position: static;
        height: auto;
        padding-bottom: 1rem;
    }
    .col-md-2.sidebar {
        flex: 0 0 100%;
        max-width: 100%;
        margin-bottom: 1rem;
    }
    .col-md-10 {
        flex: 0 0 100%;
        max-width: 100%;
    }
    .stat-card {
        margin-bottom: 1rem;
    }
    .card {
        margin-bottom: 1.5rem;
    }
    .quantity-overview-container {
        grid-template-columns: 1fr;
    }
}
@media (max-width: 768px) {
    .navbar-brand {
        font-size: 1rem;
    }
    .sidebar .nav-link {
        padding: 0.7rem 1rem;
        font-size: 0.98rem;
    }
    .stat-card {
        padding: 1rem 0.3rem;
        font-size: 0.95rem;
    }
    .card-header h5, h2 {
        font-size: 1.1rem;
    }
    .table-responsive {
        font-size: 0.95rem;
    }
    .category-tab {
        padding: 8px 12px;
        font-size: 0.95rem;
    }
    .quantity-table-container {
        max-height: 300px;
    }
}
@media (max-width: 576px) {
    .navbar {
        padding: 0.5rem 0.7rem;
    }
    .sidebar {
        padding-top: 0.5rem;
    }
    .stat-card {
        padding: 0.7rem 0.2rem;
        font-size: 0.9rem;
    }
    .card {
        margin-bottom: 1rem;
    }
    .modal-content {
        padding: 0.5rem;
    }
    .sync-status {
        bottom: 12px;
        right: 12px;
        padding: 8px 12px;
        font-size: 0.95rem;
    }
    .category-tab {
        padding: 6px 8px;
        font-size: 0.9rem;
    }
    .quantity-table th, .quantity-table td {
        padding: 0.5rem;
    }
}
    </style>
    <!-- Google API scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-boxes me-2"></i>
                Inventory Management System
            </a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar p-0">
                <nav class="nav flex-column">
                    <a class="nav-link active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                    </a>
                    <a class="nav-link" data-page="products">
                        <i class="fas fa-box me-2"></i> Products Inventory
                    </a>
                    <a class="nav-link" data-page="medicines">
                        <i class="fas fa-pills me-2"></i> Medicines & Vitamins
                    </a>
                    <a class="nav-link" data-page="settings">
                        <i class="fas fa-cog me-2"></i> Settings
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <!-- Dashboard Page -->
                <div class="page-content active" id="dashboard">
                    <h2 class="mb-4">Dashboard Overview</h2>
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card stat-card">
                                <div class="stat-number" id="totalProducts">0</div>
                                <div class="stat-label">Total Products</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stat-card">
                                <div class="stat-number" id="totalMedicines">0</div>
                                <div class="stat-label">Medicines</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stat-card">
                                <div class="stat-number" id="lowStockItems">0</div>
                                <div class="stat-label">Low Stock Items</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- New Quantity Overview Section -->
                    <div class="card mb-4">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Inventory Quantity Overview</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2" id="sortByCategory">
                                    <i class="fas fa-sort-alpha-down me-1"></i> Sort by Category
                                </button>
                                <button class="btn btn-sm btn-outline-primary" id="sortByQuantity">
                                    <i class="fas fa-sort-numeric-down me-1"></i> Sort by Quantity
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="quantity-overview-container">
                                <div class="quantity-table-container">
                                    <h6>Products</h6>
                                    <table class="table table-sm quantity-table mb-0">
                                        <thead>
                                            <tr>
                                                <th data-sort="name">Product Name</th>
                                                <th data-sort="category">Category</th>
                                                <th data-sort="quantity">Quantity</th>
                                                <th>Expiry Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="productsQuantityList">
                                            <tr>
                                                <td colspan="4" class="text-center py-3">No products available</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="quantity-table-container">
                                    <h6>Medicines & Vitamins</h6>
                                    <table class="table table-sm quantity-table mb-0">
                                        <thead>
                                            <tr>
                                                <th data-sort="name">Medicine Name</th>
                                                <th data-sort="category">Category</th>
                                                <th data-sort="quantity">Quantity</th>
                                                <th>Expiry Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="medicinesQuantityList">
                                            <tr>
                                                <td colspan="4" class="text-center py-3">No medicines available</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header bg-white">
                            <h5>Recent Activities</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush" id="recentActivities">
                                <li class="list-group-item">No recent activities</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Products Inventory Page -->
                <div class="page-content" id="products">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Products Inventory</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                            <i class="fas fa-plus me-1"></i> Add Product
                        </button>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search products..." id="productSearch">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="productCategoryFilter">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="productSort">
                                <option value="name">Sort by Name</option>
                                <option value="quantity">Sort by Quantity</option>
                                <option value="category">Sort by Category</option>
                                <option value="weight">Sort by Weight</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover inventory-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th>Weight</th>
                                    <th>Actions</th>
                                    <th>Last Updated</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <tr>
                                    <td colspan="6" class="text-center">No products found. Add some products to get started.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Medicines & Vitamins Page -->
                <div class="page-content" id="medicines">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Medicines & Vitamins Inventory</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMedicineModal">
                            <i class="fas fa-plus me-1"></i> Add Medicine
                        </button>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search medicines..." id="medicineSearch">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="medicineCategoryFilter">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="medicineSort">
                                <option value="name">Sort by Name</option>
                                <option value="quantity">Sort by Quantity</option>
                                <option value="category">Sort by Category</option>
                                <option value="weight">Sort by Weight</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover inventory-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th>Weight</th>
                                    <th>Expiry Date</th>
                                    <th>Actions</th>
                                    <th>Last Updated</th>
                                </tr>
                            </thead>
                            <tbody id="medicinesTableBody">
                                <tr>
                                    <td colspan="8" class="text-center">No medicines found. Add some medicines to get started.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page-content" id="settings">
                    <h2 class="mb-4">Settings</h2>
                    <div class="card mb-4">
                        <div class="card-header bg-white">
                            <h5>Excel Integration</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="excelFile" class="form-label">Import from Excel</label>
                                    <input class="form-control" type="file" id="excelFile" accept=".xlsx, .xls">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Export to Excel</label>
                                    <div>
                                        <button class="btn btn-success" id="exportProducts">
                                            <i class="fas fa-file-export me-1"></i> Export Products
                                        </button>
                                        <button class="btn btn-success" id="exportMedicines">
                                            <i class="fas fa-file-export me-1"></i> Export Medicines
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-4">
                        <div class="card-header bg-white">
                            <h5>Google Sheet Sync</h5>
                        </div>
                        <div class="card-body">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="autoSyncToggle" checked>
                                <label class="form-check-label" for="autoSyncToggle">Enable Auto Sync</label>
                            </div>
                            <button class="btn btn-info mb-2" id="syncToGoogleSheet">
                                <i class="fas fa-cloud-upload-alt me-1"></i> Sync to Google Sheet
                            </button>
                            <button class="btn btn-info mb-2" id="loadFromGoogleSheet">
                                <i class="fas fa-cloud-download-alt me-1"></i> Load from Google Sheet
                            </button>
                            <button class="btn btn-outline-primary mb-2" id="googleSignInBtn">
                                <i class="fab fa-google me-1"></i> Sign In with Google
                            </button>
                            <button class="btn btn-outline-danger mb-2" id="googleSignOutBtn" style="display:none;">
                                <i class="fas fa-sign-out-alt me-1"></i> Sign Out
                            </button>
                            <div id="googleStatus" class="mt-2"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header bg-white">
                            <h5>Categories Management</h5>
                            <div class="d-flex mt-2">
                                <div class="category-tab active" data-category-type="product">Product Categories</div>
                                <div class="category-tab" data-category-type="medicine">Medicine Categories</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="newCategory" class="form-label">Add New Category</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="newCategory" placeholder="Category name">
                                            <button class="btn btn-primary" id="addCategoryBtn">Add</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Existing Categories</label>
                                    <ul class="list-group" id="categoriesList">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="mb-3">
                            <label for="productName" class="form-label">Product Name</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="mb-3">
                            <label for="productCategory" class="form-label">Category</label>
                            <select class="form-select" id="productCategory" required>
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="initialQuantity" class="form-label">Initial Quantity</label>
                            <input type="number" class="form-control" id="initialQuantity" min="0" value="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="productWeight" class="form-label">Weight</label>
                            <div class="weight-input-group">
                                <input type="number" class="form-control" id="productWeight" min="0" step="0.01" value="0" required>
                                <select class="form-select" id="productWeightUnit">
                                    <option value="kg">kg</option>
                                    <option value="g">g</option>
                                    <option value="mg">mg</option>
                                    <option value="lb">lb</option>
                                    <option value="oz">oz</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="expiryDate" class="form-label">Expiry Date (Optional)</label>
                            <input type="date" class="form-control" id="expiryDate">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveProductBtn">Save Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Medicine Modal -->
    <div class="modal fade" id="addMedicineModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Medicine/Vitamin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addMedicineForm">
                        <div class="mb-3">
                            <label for="medicineName" class="form-label">Medicine Name</label>
                            <input type="text" class="form-control" id="medicineName" required>
                        </div>
                        <div class="mb-3">
                            <label for="medicineType" class="form-label">Type</label>
                            <select class="form-select" id="medicineType" required>
                                <option value="Medicine">Medicine</option>
                                <option value="Vitamin">Vitamin</option>
                                <option value="Supplement">Supplement</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="medicineCategory" class="form-label">Category</label>
                            <select class="form-select" id="medicineCategory" required>
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="medicineQuantity" class="form-label">Initial Quantity</label>
                            <input type="number" class="form-control" id="medicineQuantity" min="0" value="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="medicineWeight" class="form-label">Weight</label>
                            <div class="weight-input-group">
                                <input type="number" class="form-control" id="medicineWeight" min="0" step="0.01" value="0" required>
                                <select class="form-select" id="medicineWeightUnit">
                                    <option value="kg">kg</option>
                                    <option value="g">g</option>
                                    <option value="mg">mg</option>
                                    <option value="lb">lb</option>
                                    <option value="oz">oz</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="expiryDate" class="form-label">Expiry Date (Optional)</label>
                            <input type="date" class="form-control" id="expiryDate">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveMedicineBtn">Save Medicine</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Adjust Quantity Modal -->
    <div class="modal fade" id="adjustQuantityModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="adjustModalTitle">Adjust Quantity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Current Quantity: <span id="currentQuantityDisplay">0</span></p>
                    <div class="mb-3">
                        <label for="adjustmentAmount" class="form-label">Adjustment Amount</label>
                        <input type="number" class="formcontrol" id="adjustmentAmount" min="1" value="1" required>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="adjustmentType" id="addStock" value="add" checked>
                        <label class="form-check-label" for="addStock">
                            Add to Stock
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="adjustmentType" id="removeStock" value="remove">
                        <label class="form-check-label" for="removeStock">
                            Remove from Stock
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmAdjustment">Confirm Adjustment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Status Indicator -->
    <div class="sync-status" id="syncStatus"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// Google API Setup
const CLIENT_ID = '951807937266-go3icp4lgr2s7ertj15rrvuvv9fc9tf0.apps.googleusercontent.com';
const API_KEY = 'AIzaSyC5qZrfXb3BHXcNQ6qgCYKLNAQ1uS7KQmE';
const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
const SPREADSHEET_ID = '1nT6qcCqPr48ia-TxaLx1xjyqnFmubxfkUXZERznUBc4';

let gapiLoaded = false;
let gisLoaded = false;
let tokenClient;
let gapiInited = false;
let gisInited = false;
let googleSignedIn = false;
let autoSyncEnabled = true;
let syncInProgress = false;

function updateGoogleStatus(msg) {
    document.getElementById('googleStatus').textContent = msg;
}

function showSignInBtn(show) {
    document.getElementById('googleSignInBtn').style.display = show ? '' : 'none';
    document.getElementById('googleSignOutBtn').style.display = show ? 'none' : '';
}

function gapiLoadedCallback() {
    gapiLoaded = true;
    maybeEnableGoogleButtons();
}

function gisLoadedCallback() {
    gisLoaded = true;
    maybeEnableGoogleButtons();
}

function maybeEnableGoogleButtons() {
    if (gapiLoaded && gisLoaded) {
        document.getElementById('googleSignInBtn').disabled = false;
    }
}

// Load Google API
window.onload = function() {
    gapi.load('client', initializeGapiClient);
};

function initializeGapiClient() {
    gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: [DISCOVERY_DOC],
    }).then(function() {
        gapiInited = true;
        updateGoogleStatus('Google API loaded.');
    }, function(error) {
        updateGoogleStatus('Google API failed to load.');
    });
}

// Google Identity Services
document.getElementById('googleSignInBtn').addEventListener('click', function() {
    if (!tokenClient) {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: (tokenResponse) => {
                gapi.client.setToken(tokenResponse);
                googleSignedIn = true;
                showSignInBtn(false);
                updateGoogleStatus('Signed in to Google.');
                // Auto sync after sign in
                if (autoSyncEnabled) {
                    autoSyncToGoogleSheet();
                }
            },
        });
    }
    tokenClient.requestAccessToken();
});

document.getElementById('googleSignOutBtn').addEventListener('click', function() {
    googleSignedIn = false;
    gapi.client.setToken('');
    showSignInBtn(true);
    updateGoogleStatus('Signed out from Google.');
});

document.getElementById('autoSyncToggle').addEventListener('change', function() {
    autoSyncEnabled = this.checked;
});

// Sync to Google Sheet
document.getElementById('syncToGoogleSheet').addEventListener('click', function() {
    syncToGoogleSheet();
});

document.getElementById('loadFromGoogleSheet').addEventListener('click', function() {
    loadFromGoogleSheet();
});

function syncToGoogleSheet() {
    if (!googleSignedIn) {
        updateGoogleStatus('Please sign in to Google first.');
        return;
    }

    showSyncStatus('Syncing to Google Sheet...', 'loading');
    syncInProgress = true;

    const products = JSON.parse(localStorage.getItem('products')) || [];
    const medicines = JSON.parse(localStorage.getItem('medicines')) || [];

    // Create headers for empty sheets
    const productsHeaders = [['Name', 'Category', 'Quantity', 'Weight', 'Weight Unit', 'Expiry Date', 'Last Updated']];
    const medicinesHeaders = [['Name', 'Type', 'Category', 'Quantity', 'Weight', 'Weight Unit', 'Expiry Date', 'Last Updated']];

    const productsData = products.length > 0 
        ? products.map(p => [p.name, p.category, p.quantity, p.weight, p.weightUnit, p.expiryDate || '', p.lastUpdated])
        : productsHeaders;
        
    const medicinesData = medicines.length > 0 
        ? medicines.map(m => [m.name, m.type, m.category, m.quantity, m.weight, m.weightUnit, m.expiryDate || '', m.lastUpdated])
        : medicinesHeaders;

    // Calculate ranges based on data length
    const productsRange = products.length > 0 
        ? `Products!A2:G${products.length + 1}` 
        : 'Products!A2:G2';
        
    const medicinesRange = medicines.length > 0 
        ? `Medicines!A2:H${medicines.length + 1}` 
        : 'Medicines!A2:H2';

    const values = [
        {range: productsRange, values: productsData},
        {range: medicinesRange, values: medicinesData}
    ];

    const body = {
        data: values,
        valueInputOption: 'USER_ENTERED'
    };

    gapi.client.sheets.spreadsheets.values.batchUpdate({
        spreadsheetId: SPREADSHEET_ID,
        resource: body
    }).then((response) => {
        showSyncStatus('Data synced to Google Sheet successfully!', 'success');
        setTimeout(() => hideSyncStatus(), 3000);
        syncInProgress = false;
    }, (reason) => {
        showSyncStatus('Error syncing to Google Sheet: ' + reason.result.error.message, 'error');
        setTimeout(() => hideSyncStatus(), 5000);
        syncInProgress = false;
    });
}


function loadFromGoogleSheet() {
    if (!googleSignedIn) {
        updateGoogleStatus('Please sign in to Google first.');
        return;
    }

    showSyncStatus('Loading from Google Sheet...', 'loading');
    syncInProgress = true;

    gapi.client.sheets.spreadsheets.values.batchGet({
        spreadsheetId: SPREADSHEET_ID,
        ranges: ['Products!A2:G', 'Medicines!A2:H2'],
    }).then((response) => {
        const result = response.result;
        const productRanges = result.valueRanges[0];
        const medicineRanges = result.valueRanges[1];

        if (productRanges.values) {
            const products = productRanges.values.map(row => ({
                name: row[0],
                category: row[1],
                quantity: parseInt(row[2]),
                weight: parseFloat(row[3]),
                weightUnit: row[4],
                expiryDate: row[5] || null,
                lastUpdated: row[6] || new Date().toISOString()
            }));
            localStorage.setItem('products', JSON.stringify(products));
        }

        if (medicineRanges.values) {
            const medicines = medicineRanges.values.map(row => ({
                name: row[0],
                type: row[1],
                category: row[2],
                quantity: parseInt(row[3]),
                weight: parseFloat(row[4]),
                weightUnit: row[5],
                expiryDate: row[6] || null,
                lastUpdated: row[7] || new Date().toISOString()
            }));
            localStorage.setItem('medicines', JSON.stringify(medicines));
        }

        loadData();
        showSyncStatus('Data loaded from Google Sheet successfully!', 'success');
        setTimeout(() => hideSyncStatus(), 3000);
        syncInProgress = false;
    }, (reason) => {
        showSyncStatus('Error loading from Google Sheet: ' + reason.result.error.message, 'error');
        setTimeout(() => hideSyncStatus(), 5000);
        syncInProgress = false;
    });
}

function autoSyncToGoogleSheet() {
    if (autoSyncEnabled && googleSignedIn && !syncInProgress) {
        syncToGoogleSheet();
    }
}

function showSyncStatus(message, type) {
    const statusEl = document.getElementById('syncStatus');
    statusEl.textContent = message;
    statusEl.className = 'sync-status';
    statusEl.classList.add(`sync-${type}`);
    statusEl.style.display = 'block';
}

function hideSyncStatus() {
    document.getElementById('syncStatus').style.display = 'none';
}

// Excel Import/Export
document.getElementById('exportProducts').addEventListener('click', function() {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    exportToExcel(products, 'Products Inventory');
});

document.getElementById('exportMedicines').addEventListener('click', function() {
    const medicines = JSON.parse(localStorage.getItem('medicines')) || [];
    exportToExcel(medicines, 'Medicines Inventory');
});

document.getElementById('excelFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});

        // Process first sheet
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet);

        if (jsonData.length > 0) {
            // Determine if it's products or medicines based on columns
            const firstRow = jsonData[0];
            if (firstRow.hasOwnProperty('Type')) {
                // Medicines data
                localStorage.setItem('medicines', JSON.stringify(jsonData));
            } else {
                // Products data
                localStorage.setItem('products', JSON.stringify(jsonData));
            }

            loadData();
            showSyncStatus('Data imported from Excel successfully!', 'success');
            setTimeout(() => hideSyncStatus(), 3000);
            autoSyncToGoogleSheet();
        }
    };
    reader.readAsArrayBuffer(file);
});

function exportToExcel(data, fileName) {
    const worksheet = XLSX.utils.json_to_sheet(data);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Inventory');
    XLSX.writeFile(workbook, `${fileName}.xlsx`);
}

// Inventory Management
let currentAdjustingItem = null;
let currentAdjustingType = null;

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    // Initialize categories if not exists
    if (!localStorage.getItem('productCategories')) {
        localStorage.setItem('productCategories', JSON.stringify(['Electronics', 'Clothing', 'Food', 'Books', 'Other']));
    }
    if (!localStorage.getItem('medicineCategories')) {
        localStorage.setItem('medicineCategories', JSON.stringify(['Pain Relief', 'Vitamins', 'First Aid', 'Supplements', 'Other']));
    }

    // Load data
    loadData();

    // Setup event listeners
    setupEventListeners();

    // Setup navigation
    setupNavigation();

    // Setup category tabs
    setupCategoryTabs();
});

function loadData() {
    loadProducts();
    loadMedicines();
    updateDashboardStats();
    updateCategoryFilters();
    updateQuantityOverview();
}

function loadProducts() {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    const tbody = document.getElementById('productsTableBody');
    tbody.innerHTML = '';

    if (products.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center">No products found. Add some products to get started.</td></tr>';
        return;
    }

    products.forEach((product, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${product.name}</td>
            <td><span class="category-badge">${product.category}</span></td>
            <td class="quantity-display ${product.quantity < 10 ? 'low-quantity' : ''}">${product.quantity}</td>
            <td>${product.weight} ${product.weightUnit}</td>
            <td>
                <i class="fas fa-plus-circle add-btn action-btn" data-index="${index}" data-type="product"></i>
                <i class="fas fa-minus-circle remove-btn action-btn" data-index="${index}" data-type="product"></i>
            </td>
            <td>${formatDate(product.lastUpdated)}</td>
        `;
        tbody.appendChild(row);
    });

    // Add event listeners to action buttons
    document.querySelectorAll('.add-btn, .remove-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const index = this.getAttribute('data-index');
            const type = this.getAttribute('data-type');
            openAdjustQuantityModal(index, type);
        });
    });
}

function loadMedicines() {
    const medicines = JSON.parse(localStorage.getItem('medicines')) || [];
    const tbody = document.getElementById('medicinesTableBody');
    tbody.innerHTML = '';

    if (medicines.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center">No medicines found. Add some medicines to get started.</td></tr>';
        return;
    }

    medicines.forEach((medicine, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${medicine.name}</td>
            <td>${medicine.type}</td>
            <td><span class="category-badge">${medicine.category}</span></td>
            <td class="quantity-display ${medicine.quantity < 10 ? 'low-quantity' : ''}">${medicine.quantity}</td>
            <td>${medicine.weight} ${medicine.weightUnit}</td>
            <td>${medicine.expiryDate ? formatDate(medicine.expiryDate) : 'N/A'}</td>
            <td>
                <i class="fas fa-plus-circle add-btn action-btn" data-index="${index}" data-type="medicine"></i>
                <i class="fas fa-minus-circle remove-btn action-btn" data-index="${index}" data-type="medicine"></i>
            </td>
            <td>${formatDate(medicine.lastUpdated)}</td>
        `;
        tbody.appendChild(row);
    });

    // Add event listeners to action buttons
    document.querySelectorAll('.add-btn, .remove-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const index = this.getAttribute('data-index');
            const type = this.getAttribute('data-type');
            openAdjustQuantityModal(index, type);
        });
    });
}

function updateDashboardStats() {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    const medicines = JSON.parse(localStorage.getItem('medicines')) || [];
    
    document.getElementById('totalProducts').textContent = products.length;
    document.getElementById('totalMedicines').textContent = medicines.length;
    
    const lowStockItems = [...products, ...medicines].filter(item => item.quantity < 10).length;
    document.getElementById('lowStockItems').textContent = lowStockItems;
}

function updateCategoryFilters() {
    const productCategories = JSON.parse(localStorage.getItem('productCategories')) || [];
    const medicineCategories = JSON.parse(localStorage.getItem('medicineCategories')) || [];
    
    // Update product category filter
    const productCategoryFilter = document.getElementById('productCategoryFilter');
    productCategoryFilter.innerHTML = '<option value="">All Categories</option>';
    productCategories.forEach(category => {
        productCategoryFilter.innerHTML += `<option value="${category}">${category}</option>`;
    });
    
    // Update medicine category filter
    const medicineCategoryFilter = document.getElementById('medicineCategoryFilter');
    medicineCategoryFilter.innerHTML = '<option value="">All Categories</option>';
    medicineCategories.forEach(category => {
        medicineCategoryFilter.innerHTML += `<option value="${category}">${category}</option>`;
    });
    
    // Update add product modal category dropdown
    const productCategory = document.getElementById('productCategory');
    productCategory.innerHTML = '<option value="">Select Category</option>';
    productCategories.forEach(category => {
        productCategory.innerHTML += `<option value="${category}">${category}</option>`;
    });
    
    // Update add medicine modal category dropdown
    const medicineCategory = document.getElementById('medicineCategory');
    medicineCategory.innerHTML = '<option value="">Select Category</option>';
    medicineCategories.forEach(category => {
        medicineCategory.innerHTML += `<option value="${category}">${category}</option>`;
    });
}

function updateQuantityOverview() {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    const medicines = JSON.parse(localStorage.getItem('medicines')) || [];
    
    // Update products quantity list
    const productsList = document.getElementById('productsQuantityList');
    productsList.innerHTML = '';
    
    if (products.length === 0) {
        productsList.innerHTML = '<tr><td colspan="4" class="text-center py-3">No products available</td></tr>';
    } else {
        products.forEach(product => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${product.name}</td>
                <td><span class="category-badge">${product.category}</span></td>
                <td class="${product.quantity < 10 ? 'low-quantity' : ''}">${product.quantity}</td>
                <td>${product.expiryDate ? formatDate(product.expiryDate) : 'N/A'}</td>
            `;
            productsList.appendChild(row);
        });
    }
    
    // Update medicines quantity list
    const medicinesList = document.getElementById('medicinesQuantityList');
    medicinesList.innerHTML = '';
    
    if (medicines.length === 0) {
        medicinesList.innerHTML = '<tr><td colspan="4" class="text-center py-3">No medicines available</td></tr>';
    } else {
        medicines.forEach(medicine => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${medicine.name}</td>
                <td><span class="category-badge">${medicine.category}</span></td>
                <td class="${medicine.quantity < 10 ? 'low-quantity' : ''}">${medicine.quantity}</td>
                <td>${medicine.expiryDate ? formatDate(medicine.expiryDate) : 'N/A'}</td>
            `;
            medicinesList.appendChild(row);
        });
    }
}

function setupEventListeners() {
    // Save product button
    document.getElementById('saveProductBtn').addEventListener('click', function() {
        const name = document.getElementById('productName').value;
        const category = document.getElementById('productCategory').value;
        const quantity = parseInt(document.getElementById('initialQuantity').value);
        const weight = parseFloat(document.getElementById('productWeight').value);
        const weightUnit = document.getElementById('productWeightUnit').value;
        const expiryDate = document.getElementById('expiryDate').value || null;
        
        if (!name || !category) {
            alert('Please fill in all required fields.');
            return;
        }
        
        const products = JSON.parse(localStorage.getItem('products')) || [];
        products.push({
            name,
            category,
            quantity,
            weight,
            weightUnit,
            expiryDate,
            lastUpdated: new Date().toISOString()
        });
        
        localStorage.setItem('products', JSON.stringify(products));
        
        // Close modal and reset form
        bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
        document.getElementById('addProductForm').reset();
        
        // Update UI
        loadData();
        autoSyncToGoogleSheet();
    });
    
    // Save medicine button
    document.getElementById('saveMedicineBtn').addEventListener('click', function() {
        const name = document.getElementById('medicineName').value;
        const type = document.getElementById('medicineType').value;
        const category = document.getElementById('medicineCategory').value;
        const quantity = parseInt(document.getElementById('medicineQuantity').value);
        const weight = parseFloat(document.getElementById('medicineWeight').value);
        const weightUnit = document.getElementById('medicineWeightUnit').value;
        const expiryDate = document.getElementById('expiryDate').value || null;
        
        if (!name || !category) {
            alert('Please fill in all required fields.');
            return;
        }
        
        const medicines = JSON.parse(localStorage.getItem('medicines')) || [];
        medicines.push({
            name,
            type,
            category,
            quantity,
            weight,
            weightUnit,
            expiryDate,
            lastUpdated: new Date().toISOString()
        });
        
        localStorage.setItem('medicines', JSON.stringify(medicines));
        
        // Close modal and reset form
        bootstrap.Modal.getInstance(document.getElementById('addMedicineModal')).hide();
        document.getElementById('addMedicineForm').reset();
        
        // Update UI
        loadData();
        autoSyncToGoogleSheet();
    });
    
    // Confirm adjustment button
    document.getElementById('confirmAdjustment').addEventListener('click', function() {
        if (!currentAdjustingItem) return;
        
        const amount = parseInt(document.getElementById('adjustmentAmount').value);
        const isAdd = document.getElementById('addStock').checked;
        
        if (isNaN(amount) || amount <= 0) {
            alert('Please enter a valid adjustment amount.');
            return;
        }
        
        let items;
        if (currentAdjustingType === 'product') {
            items = JSON.parse(localStorage.getItem('products')) || [];
        } else {
            items = JSON.parse(localStorage.getItem('medicines')) || [];
        }
        
        if (isAdd) {
            items[currentAdjustingItem].quantity += amount;
        } else {
            items[currentAdjustingItem].quantity = Math.max(0, items[currentAdjustingItem].quantity - amount);
        }
        
        items[currentAdjustingItem].lastUpdated = new Date().toISOString();
        
        if (currentAdjustingType === 'product') {
            localStorage.setItem('products', JSON.stringify(items));
        } else {
            localStorage.setItem('medicines', JSON.stringify(items));
        }
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('adjustQuantityModal')).hide();
        
        // Update UI
        loadData();
        autoSyncToGoogleSheet();
    });
    
    // Add category button
    document.getElementById('addCategoryBtn').addEventListener('click', function() {
        const newCategory = document.getElementById('newCategory').value.trim();
        if (!newCategory) return;
        
        const activeTab = document.querySelector('.category-tab.active');
        const categoryType = activeTab.getAttribute('data-category-type');
        
        let categories;
        if (categoryType === 'product') {
            categories = JSON.parse(localStorage.getItem('productCategories')) || [];
        } else {
            categories = JSON.parse(localStorage.getItem('medicineCategories')) || [];
        }
        
        if (!categories.includes(newCategory)) {
            categories.push(newCategory);
            
            if (categoryType === 'product') {
                localStorage.setItem('productCategories', JSON.stringify(categories));
            } else {
                localStorage.setItem('medicineCategories', JSON.stringify(categories));
            }
            
            document.getElementById('newCategory').value = '';
            updateCategoryFilters();
            updateCategoriesList();
        }
    });
    
    // Sort buttons for quantity overview
    document.getElementById('sortByCategory').addEventListener('click', function() {
        sortQuantityOverview('category');
    });
    
    document.getElementById('sortByQuantity').addEventListener('click', function() {
        sortQuantityOverview('quantity');
    });
}

function setupNavigation() {
    // Navigation links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function() {
            const page = this.getAttribute('data-page');
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(page).classList.add('active');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            this.classList.add('active');
        });
    });
}

function setupCategoryTabs() {
    document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.category-tab').forEach(t => {
                t.classList.remove('active');
            });
            this.classList.add('active');
            updateCategoriesList();
        });
    });
    
    // Initial update
    updateCategoriesList();
}

function updateCategoriesList() {
    const activeTab = document.querySelector('.category-tab.active');
    const categoryType = activeTab.getAttribute('data-category-type');
    
    let categories;
    if (categoryType === 'product') {
        categories = JSON.parse(localStorage.getItem('productCategories')) || [];
    } else {
        categories = JSON.parse(localStorage.getItem('medicineCategories')) || [];
    }
    
    const categoriesList = document.getElementById('categoriesList');
    categoriesList.innerHTML = '';
    
    categories.forEach(category => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `
            ${category}
            <button class="btn btn-sm btn-outline-danger delete-category-btn" data-category="${category}" data-type="${categoryType}">
                <i class="fas fa-trash"></i>
            </button>
        `;
        categoriesList.appendChild(li);
    });
    
    // Add event listeners to delete buttons
    document.querySelectorAll('.delete-category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const category = this.getAttribute('data-category');
            const type = this.getAttribute('data-type');
            
            let categories;
            if (type === 'product') {
                categories = JSON.parse(localStorage.getItem('productCategories')) || [];
            } else {
                categories = JSON.parse(localStorage.getItem('medicineCategories')) || [];
            }
            
            const index = categories.indexOf(category);
            if (index !== -1) {
                categories.splice(index, 1);
                
                if (type === 'product') {
                    localStorage.setItem('productCategories', JSON.stringify(categories));
                } else {
                    localStorage.setItem('medicineCategories', JSON.stringify(categories));
                }
                
                updateCategoryFilters();
                updateCategoriesList();
            }
        });
    });
}

function openAdjustQuantityModal(index, type) {
    currentAdjustingItem = parseInt(index);
    currentAdjustingType = type;
    
    let items;
    if (type === 'product') {
        items = JSON.parse(localStorage.getItem('products')) || [];
    } else {
        items = JSON.parse(localStorage.getItem('medicines')) || [];
    }
    
    if (items.length <= currentAdjustingItem) return;
    
    const item = items[currentAdjustingItem];
    document.getElementById('currentQuantityDisplay').textContent = item.quantity;
    document.getElementById('adjustModalTitle').textContent = `Adjust Quantity - ${item.name}`;
    
    const modal = new bootstrap.Modal(document.getElementById('adjustQuantityModal'));
    modal.show();
}

function sortQuantityOverview(sortBy) {
    const productsList = document.getElementById('productsQuantityList');
    const medicinesList = document.getElementById('medicinesQuantityList');
    
    // Sort products
    const productsRows = Array.from(productsList.querySelectorAll('tr'));
    productsRows.sort((a, b) => {
        let aValue, bValue;
        
        if (sortBy === 'category') {
            aValue = a.cells[1].textContent;
            bValue = b.cells[1].textContent;
        } else if (sortBy === 'quantity') {
            aValue = parseInt(a.cells[2].textContent);
            bValue = parseInt(b.cells[2].textContent);
        } else {
            aValue = a.cells[0].textContent;
            bValue = b.cells[0].textContent;
        }
        
        if (aValue < bValue) return -1;
        if (aValue > bValue) return 1;
        return 0;
    });
    
    productsRows.forEach(row => productsList.appendChild(row));
    
    // Sort medicines
    const medicinesRows = Array.from(medicinesList.querySelectorAll('tr'));
    medicinesRows.sort((a, b) => {
        let aValue, bValue;
        
        if (sortBy === 'category') {
            aValue = a.cells[1].textContent;
            bValue = b.cells[1].textContent;
        } else if (sortBy === 'quantity') {
            aValue = parseInt(a.cells[2].textContent);
            bValue = parseInt(b.cells[2].textContent);
        } else {
            aValue = a.cells[0].textContent;
            bValue = b.cells[0].textContent;
        }
        
        if (aValue < bValue) return -1;
        if (aValue > bValue) return 1;
        return 0;
    });
    
    medicinesRows.forEach(row => medicinesList.appendChild(row));
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString();
}
</script>
</body>
</html>
